тЬЕ 1. рдХреНрдпреЛрдВ nginx pod рд░рди рдирд╣реАрдВ рд╣реБрдЖ?

OpenShift by default restricted SCC рд▓рдЧрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗ container root user рдмрдирдХрд░ 80 port bind рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ред

Normal nginx image tries to use:

user: root
port: 80


рдЬреЛ allowed рдирд╣реАрдВ рд╣реИ тЖТ рдЗрд╕рд▓рд┐рдП pod CrashLoopBackOff / Error рдореЗрдВ рдЪрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред

тЬЕ 2. рдЗрд╕рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо ServiceAccount + anyuid SCC рджреЗрддреЗ рд╣реИрдВ
тЮд ServiceAccount рдмрдирд╛рдУ
oc create serviceaccount nginx

тЮд рдЗрд╕ SA рдХреЛ anyuid SCC рджреЛ
oc adm policy add-scc-to-user anyuid -z nginx

тЮд Deployment рдореЗрдВ рдЗрд╕ SA рдХреЛ рд╕реЗрдЯ рдХрд░реЛ
oc set serviceaccount deployment/webserver nginx


Deployment рджреЛрдмрд╛рд░рд╛ rollout рд╣реЛрдЧрд╛ рдФрд░ рдирдпрд╛ pod Running рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

тЬЕ 3. Route рдХреИрд╕реЗ рдмрдирддрд╛ рд╣реИ?
Step-1: Service expose рд╣реЛрддреА рд╣реИ

рдЖрдкрдХреА nginx deployment рдХрд╛ service:

oc get svc


рдпреЗ service рд╣реА traffic pod рддрдХ рднреЗрдЬреЗрдЧреАред

тЭЧImportant Concept (Banking Grade Explanation)
Route service рд╕реЗ рдЬреБрдбрд╝рддрд╛ рд╣реИ

рд▓реЗрдХрд┐рди

Traffic last рдореЗрдВ pod рдХреЗ endpoint рддрдХ рдЬрд╛рддрд╛ рд╣реИ

рдЬреИрд╕реЗ:

oc describe route webserver
Endpoints: 10.128.0.61:80


рдЗрд╕рдХрд╛ рдорддрд▓рдм тАФ route тЖТ service тЖТ pod endpoints.

тЬЕ 4. DNS importance

Bank banking environment рдореЗрдВ рд╣рдореЗрд╢рд╛ FQDN fixed рд╣реЛрддрд╛ рд╣реИред

Example:

apollo.apps.ocp412.networknuts.lab


рдпрджрд┐ DNS entry manually рдирд╛ рджреЗрдВ, OpenShift рдПрдХ random hostname рджреЗ рджреЗрддрд╛ рд╣реИ:

webserver-project.apps.ocp412.xxxxxx.com


рд▓реЗрдХрд┐рди banking рдореЗрдВ ALWAYS real DNS use рд╣реЛрддрд╛ рд╣реИред

тЬЕ 5. Expose an Unsecured Route
oc expose svc/webserver --hostname apollo.apps.ocp412.networknuts.lab


This is unsecure route тЖТ рдпрд╛рдиреА HTTP only.

oc get route

тЭЧUnsecure route =

тЬФ Outside тЖТ insecure
тЬФ Inside тЖТ insecure

Use-case: Lab only
Banking me allowed nahi hota.

ЁЯФР 6. Secure Route (Edge Termination) рдмрдирд╛рдирд╛ тАУ A to Z
Edge Route рдореЗрдВ:

тЬФ Outside client to Router = HTTPS (encrypted)
тЬФ Router to Pod = HTTP (unencrypted)
(banking apps рдореЗ рдЗрд╕рдХреЛ mostly use рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)

тЮд рдЖрдкрдХреЛ рджреЛ file рдЪрд╛рд╣рд┐рдП:

main.crt тЖТ certificate

app.key тЖТ private key

Banking me рдпреЗ CA рд╕реЗ sign рд╣реЛрдХрд░ рдЖрддреЗ рд╣реИрдВред
тнР Create Secure Edge Route
oc create route edge app-route-edge \
  --cert=main.crt \
  --key=app.key \
  --hostname=apollo.apps.ocp412.networknuts.lab \
  --service=webserver

Verify:
oc get route


You will see:

app-route-edge   edge   https   apollo.apps.ocp412.networknuts.lab

ЁЯФР Secure (Edge) Route Security Logic

тЬФ Outside user тЖТ HTTPS
тЭЧ Router тЖТ Service тЖТ Pod = HTTP

тЬФ рдпрд╣ 90% Banking Applications рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐
Router HTTPS offload рдХрд░ рд▓реЗрддрд╛ рд╣реИ тЖТ Pod рдкрд░ load рдирд╣реАрдВ рдЖрддрд╛ред

ЁЯУМ рдЫреЛрдЯреЗ-рдЫреЛрдЯреЗ Confusions Clear
1. route pod рд╕реЗ connect рд╣реЛрддрд╛ рд╣реИ, service рд╕реЗ рдирд╣реАрдВ?

тЮб Internally route тЖТ service тЖТ endpoint (pod IP)
рд▓реЗрдХрд┐рди oc describe route endpoints pod рджрд┐рдЦрд╛рддрд╛ рд╣реИред
рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ pod рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред

2. Route рдХрд╛ рдирд╛рдо рдХреБрдЫ рднреА рджреЗ рд╕рдХрддреЗ рд╣реИрдВ?

рд╣рд╛рдБ тЖТ unique рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

app-route-edge
test123-route
abc987route


рдХреБрдЫ рднреА рдЪрд▓реЗрдЧрд╛ред
