#ï¸âƒ£oc new-project nextcloud-app
#ï¸âƒ£oc create secret generic nextcloud-credentials \
  --from-literal=POSTGRES_HOST=db \
  --from-literal=POSTGRES_PASSWORD=nextcloud \
  --from-literal=POSTGRES_DB=nextcloud \
  --from-literal=POSTGRES_USER=nextcloud

#ï¸âƒ£oc create serviceaccount nextcloud-sa

#ï¸âƒ£oc adm policy add-scc-to-user anyuid -z nextcloud-sa

ğŸ”¹ Nextcloud (Frontend)
#ï¸âƒ£oc new-app --name nextcloud --image nextcloud:apache

ğŸ”¹ PostgreSQL (Backend)
#ï¸âƒ£oc new-app --name db --image postgres:alpine


#ï¸âƒ£oc get deployments
  NAME        READY   UP-TO-DATE   AVAILABLE
  db          0/1     1            0
  nextcloud   0/1     1            0

#ï¸âƒ£oc set env --from=secret/nextcloud-credentials deployment/nextcloud
#ï¸âƒ£oc set env --from=secret/nextcloud-credentials deployment/db
#ï¸âƒ£oc set sa deployment/nextcloud nextcloud-sa
#ï¸âƒ£oc set sa deployment/db nextcloud-sa
#ï¸âƒ£oc get svc
  NAME        TYPE        CLUSTER-IP       PORT
  db          ClusterIP  172.30.x.x        5432 
  nextcloud   ClusterIP  172.30.x.x        80

#ï¸âƒ£oc expose svc nextcloud \
  --hostname nextcloud.apps.ocp412.networknuts.lab \
  --tls-termination=edge





------------------------------------------------------------------------------------------------------------








1ï¸âƒ£ OpenShift 2-Tier Application Deployment (Aâ€“Z)
ğŸ”¹ Architecture Overview

Is deployment me 2 layers (tiers) hote hain:

ğŸ”¸ Backend

PostgreSQL database

Ye application ka data store karta hai

ğŸ”¸ Frontend

Nextcloud

User isi application se connect karta hai

User
 â†“
Route
 â†“
Nextcloud (Frontend)
 â†“
PostgreSQL (Backend)

2ï¸âƒ£ Database ke liye Required Information

Nextcloud aur PostgreSQL dono ko same database details chahiye hoti hain:

PostgreSQL host name

PostgreSQL username

PostgreSQL password

Database name

ğŸ‘‰ Ye sensitive information hoti hai
ğŸ‘‰ Isliye hum Secret ka use karte hain

3ï¸âƒ£ Secret ka Role (Very Important ğŸ”)

Hum ek common Secret banate hain jo:

Nextcloud ko mile

PostgreSQL ko bhi mile

Isse:

Password hard-code nahi hota

Security maintain rehti hai

Production standard follow hota hai

4ï¸âƒ£ New Project Create Karna
oc new-project nextcloud-app


ğŸ‘‰ Ye ek alag namespace banata hai
ğŸ‘‰ Saari resources isi project ke andar rahengi

5ï¸âƒ£ Secret Create Karna (Opaque Secret)
oc create secret generic nextcloud-credentials \
--from-literal=POSTGRES_HOST=db \
--from-literal=POSTGRES_PASSWORD=nextcloud \
--from-literal=POSTGRES_DB=nextcloud \
--from-literal=POSTGRES_USER=nextcloud

ğŸ” Yahan kya ho raha hai?

Secret ka naam: nextcloud-credentials

Type: Opaque (default)

Isme DB ki saari information store hai

6ï¸âƒ£ Opaque Secret ka Meaning (Clear Hindi)
ğŸ‘‰ Opaque Secret kya hota hai?

Generic Secret

Data base64 encoded hota hai

OpenShift ko ye nahi pata hota:

password kya hai

username kya hai

OpenShift bas:

data ko secure rakhta hai

pod tak pass kar deta hai

ğŸ“Œ Simple line:

Opaque Secret = â€œOpenShift ke liye data andarkaar hota hai,
wo sirf safely store aur forward karta hai.â€

7ï¸âƒ£ ServiceAccount aur SCC ka Concept (MOST IMPORTANT ğŸ”¥)
â“ Problem kya hoti hai?

PostgreSQL ko initialization ke time:

Superuser (root / fixed UID) access chahiye

Lekin OpenShift:

Default SCC ke saath

Pod ko random UID me chalata hai

Is wajah se DB pod fail ho sakta hai âŒ

8ï¸âƒ£ Solution: Custom ServiceAccount + anyuid SCC
ğŸ”¹ ServiceAccount create karo
oc create serviceaccount nextcloud-sa

ğŸ”¹ anyuid SCC assign karo
oc adm policy add-scc-to-user anyuid -z nextcloud-sa

ğŸ” Important samajhna

nextcloud-sa = ServiceAccount

anyuid = allow karta hai pod ko superuser UID me run karne ke liye

Pod ko directly SCC nahi dete

ServiceAccount ke through dete hain âœ…

9ï¸âƒ£ ServiceAccount ka real kaam

ServiceAccount ka use hota hai jab:

Pod ko special permissions chahiye

Jaise:

PVC create / access

Secret / ConfigMap read

OpenShift API call

Dusre namespace access

ğŸ“Œ Default ServiceAccount ye sab allow nahi karta

ğŸ”Ÿ Application Deploy Karna (oc new-app)
ğŸ”¹ Nextcloud (Frontend)
oc new-app --name nextcloud --image nextcloud:apache

ğŸ”¹ PostgreSQL (Backend)
oc new-app --name db --image postgres:alpine


ğŸ‘‰ oc new-app automatically:

Deployment create karta hai

Service create karta hai

1ï¸âƒ£1ï¸âƒ£ Deployment Status Check
oc get deployments


Expected output:

NAME        READY   UP-TO-DATE   AVAILABLE
db          0/1     1            0
nextcloud   0/1     1            0


(Initially pods start ho rahe hote hain)

1ï¸âƒ£2ï¸âƒ£ Secret ko Deployments me Inject Karna
oc set env --from=secret/nextcloud-credentials deployment/nextcloud
oc set env --from=secret/nextcloud-credentials deployment/db


ğŸ‘‰ Isse:

Secret ke values environment variables ban jaate hain

Dono applications same DB details use karte hain

1ï¸âƒ£3ï¸âƒ£ ServiceAccount ko Deployment ke saath Attach Karna
oc set sa deployment/nextcloud nextcloud-sa
oc set sa deployment/db nextcloud-sa


ğŸ‘‰ Ab dono pods:

nextcloud-sa ke under run honge

anyuid SCC ka fayda milega

1ï¸âƒ£4ï¸âƒ£ Pods Running Check Karna
oc get pods


ğŸ‘‰ Ab pods Running state me honge âœ…

1ï¸âƒ£5ï¸âƒ£ Services Check Karna
oc get svc


Example:

NAME        TYPE        CLUSTER-IP       PORT
db          ClusterIP  172.30.x.x        5432
nextcloud   ClusterIP  172.30.x.x        80

ğŸ” Important Point

db service â†’ internal use ke liye

nextcloud service â†’ frontend

1ï¸âƒ£6ï¸âƒ£ Frontend ko Expose Karna (Route)
oc expose svc nextcloud \
--hostname nextcloud.apps.ocp412.networknuts.lab


ğŸ‘‰ Sirf frontend expose karte hain
ğŸ‘‰ Backend database kabhi expose nahi karte ğŸ”

1ï¸âƒ£7ï¸âƒ£ Final Banking / Production Rule ğŸ¦

âœ” Frontend â†’ Route ke through expose
âŒ Backend â†’ sirf internal ClusterIP
âœ” Secrets â†’ Opaque
âœ” SCC â†’ ServiceAccount ke through
âœ” Hard-coding passwords âŒ
