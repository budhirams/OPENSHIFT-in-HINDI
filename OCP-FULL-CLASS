üöÄ StatefulSet + Headless Service in OpenShift ‚Äî Complete Guide
1Ô∏è‚É£ StatefulSet ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?

StatefulSet ‡§è‡§ï Kubernetes resource ‡§π‡•à ‡§ú‡•ã stateful applications (‡§ú‡•à‡§∏‡•á database, Kafka, ZooKeeper) ‡§ï‡•ã run ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è designed ‡§π‡•à‡•§

‡§Ø‡•á pods ‡§ï‡•ã stable, unique ‡§î‡§∞ predictable identities ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§

Pods ‡§ï‡•ã stable network identities (DNS) ‡§î‡§∞ persistent storage ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à‡•§

Pods ‡§ï‡§æ order ‡§î‡§∞ lifecycle control ‡§ï‡§∞‡§§‡§æ ‡§π‡•à (create, delete, update ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à)‡•§

2Ô∏è‚É£ StatefulSet ‡§ï‡•á key features
Feature	Explanation
Stable network id	Pod ‡§ï‡•á ‡§®‡§æ‡§Æ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç podname-0, podname-1, ‚Ä¶ ‡§î‡§∞ DNS ‡§∏‡•á resolve ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç
Stable storage	‡§π‡§∞ pod ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§≤‡§ó PVC create ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§ú‡•ã pod delete/ recreate ‡§™‡§∞ ‡§≠‡•Ä ‡§∞‡§π‡§§‡§æ ‡§π‡•à
Ordered deployment & scaling	Pods ‡§ï‡§æ create/delete order control ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á dependent apps ‡§†‡•Ä‡§ï ‡§∏‡•á ‡§ö‡§≤‡•á‡§Ç
Ordered rolling updates	Update controlled ‡§î‡§∞ sequentially ‡§π‡•ã‡§§‡§æ ‡§π‡•à
3Ô∏è‚É£ Headless Service ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?

Normal service ‡§è‡§ï cluster IP allocate ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§ú‡•ã traffic ‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä pod ‡§™‡§∞ ‡§≠‡•á‡§ú‡§§‡§æ ‡§π‡•à‡•§

Headless service clusterIP: None ‡§∞‡§ñ‡§ï‡§∞ ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§Ø‡•á DNS queries ‡§ï‡•ã pods ‡§ï‡•á direct endpoints ‡§™‡§∞ ‡§≠‡•á‡§ú‡§§‡§æ ‡§π‡•à, ‡§ï‡§ø‡§∏‡•Ä ‡§è‡§ï IP ‡§™‡§∞ ‡§®‡§π‡•Ä‡§Ç‡•§

StatefulSet ‡§ï‡•á pods ‡§ï‡•á ‡§≤‡§ø‡§è stable DNS records ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à‡•§

4Ô∏è‚É£ StatefulSet + Headless Service ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç?

StatefulSet Pods ‡§ï‡•á DNS ‡§®‡§æ‡§Æ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç:
<statefulset-name>-<ordinal>.<headless-service-name>.<namespace>.svc.cluster.local

Example:
mysql-0.mysql-headless.default.svc.cluster.local
mysql-1.mysql-headless.default.svc.cluster.local

Pod IP change ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≠‡•Ä DNS ‡§®‡§æ‡§Æ same ‡§∞‡§π‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏‡§∏‡•á DB cluster ‡§ú‡•à‡§∏‡•á distributed systems ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á communicate ‡§ï‡§∞ ‡§™‡§æ‡§§‡•á ‡§π‡•à‡§Ç‡•§

5Ô∏è‚É£ Practical Example: MySQL StatefulSet + Headless Service
Headless Service YAML
apiVersion: v1
kind: Service
metadata:
  name: mysql-headless
spec:
  clusterIP: None          # Headless service
  selector:
    app: mysql
  ports:
  - port: 3306
    name: mysql

StatefulSet YAML (simplified)
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
spec:
  serviceName: mysql-headless  # Must match above headless service name
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        ports:
        - containerPort: 3306
          name: mysql
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD
  volumeClaimTemplates:
  - metadata:
      name: mysql-persistent-storage
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 20Gi

6Ô∏è‚É£ VolumeClaimTemplates ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨

StatefulSet ‡§Æ‡•á‡§Ç volumeClaimTemplates ‡§∏‡•á ‡§π‡§∞ Pod ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡§æ PVC ‡§¨‡§®‡§§‡§æ ‡§π‡•à‡•§

Pod delete/restart ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§≠‡•Ä data safe ‡§∞‡§π‡§§‡§æ ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø PVC ‡§Ö‡§≤‡§ó ‡§∞‡§π‡§§‡§æ ‡§π‡•à‡•§

PVC ‡§ï‡§æ ‡§®‡§æ‡§Æ auto-generated ‡§π‡•ã‡§ó‡§æ ‡§ú‡•à‡§∏‡•á: mysql-persistent-storage-mysql-0‡•§

7Ô∏è‚É£ StatefulSet Pods DNS ‡§î‡§∞ Network

Pod 0 ‡§ï‡§æ DNS: mysql-0.mysql-headless.<namespace>.svc.cluster.local

Pod 1 ‡§ï‡§æ DNS: mysql-1.mysql-headless.<namespace>.svc.cluster.local

Pods ‡§Ö‡§™‡§®‡•Ä stable DNS ‡§∏‡•á ‡§Ü‡§™‡§∏ ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç, ‡§ú‡•ã DB cluster ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡•§

Pod IP change ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à, ‡§™‡§∞ DNS ‡§®‡§π‡•Ä‡§Ç‡•§

8Ô∏è‚É£ ‡§ï‡•ç‡§Ø‡•ã‡§Ç Banking ‡§Æ‡•á‡§Ç StatefulSet + Headless Service ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä?

Database cluster ‡§ï‡•á pods ‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ fixed identity ‡§ö‡§æ‡§π‡§ø‡§è‡•§

Firewall, Monitoring, Audit ‡§ï‡•á ‡§≤‡§ø‡§è stable hostname/IP ‡§ö‡§æ‡§π‡§ø‡§è‡•§

Data loss ‡§∏‡•á ‡§¨‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è persistent storage ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡•§

Ordered startup/shutdown DB replication ‡§î‡§∞ consistency ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§º‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à‡•§

9Ô∏è‚É£ StatefulSet Limitations ‡§î‡§∞ Considerations

StatefulSet ‡§∏‡•á automatic failover ‡§î‡§∞ clustering ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ, DB clustering tool ‡§Ø‡§æ operator ‡§ö‡§æ‡§π‡§ø‡§è‡•§

StatefulSet ‡§ï‡§æ scale up/down ‡§ß‡•Ä‡§∞‡•á-‡§ß‡•Ä‡§∞‡•á ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§

Persistent storage (PV) proper provision ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§

StatefulSet pods ‡§è‡§ï namespace ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç, cross-namespace communication ‡§Ö‡§≤‡§ó ‡§∏‡•á setup ‡§ï‡§∞‡§®‡§æ ‡§™‡§°‡§º‡§§‡§æ ‡§π‡•à‡•§

10Ô∏è‚É£ Summary Table
Concept	Role in DB Deployment
StatefulSet	Stable pods with persistent storage
Headless Service	Stable DNS names for each pod
volumeClaimTemplates	Per-pod persistent storage (PVCs)
Stable DNS	Pod-0, Pod-1 etc fixed DNS
Use in Banking	High availability, stable identity, secure connection

‡§Ö‡§ó‡§∞ ‡§ö‡§æ‡§π‡•á‡§Ç, ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•ã full production-ready MySQL/Postgres StatefulSet+Headless service YAML ‡§≠‡•Ä ‡§¶‡•á ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç secrets, configmaps, resource limits ‡§î‡§∞ readiness probes ‡§π‡•ã‡§Ç‡•§

‡§¨‡§§‡§æ‡§á‡§è!















--------------------------------------------------------------------------------------------------------------------------------

‚úî Full production-style MySQL StatefulSet
‚úî Headless Service
‚úî Secret
‚úî PVC
‚úî Commands
‚úî Verification steps



üöÄ Killer Koda: StatefulSet + Headless Service Practical (MySQL)


‚úÖ STEP-1: Secret ‡§¨‡§®‡§æ‡§®‡§æ

MySQL ‡§ï‡•ã password ‡§ö‡§æ‡§π‡§ø‡§è, ‡§á‡§∏‡§≤‡§ø‡§è ‡§™‡§π‡§≤‡•á secret create ‡§ï‡§∞‡•á‡§Ç:

üëâ mysql-secret.yaml

apiVersion: v1
kind: Secret
metadata:
  name: mysql-secret
type: Opaque
data:
  MYSQL_ROOT_PASSWORD: bXlzcWwxMjM=   # base64 of mysql


Apply:

kubectl apply -f mysql-secret.yaml

‚úÖ STEP-2: Headless Service ‡§¨‡§®‡§æ‡§®‡§æ

üëâ mysql-headless.yaml

apiVersion: v1
kind: Service
metadata:
  name: mysql-headless
  labels:
    app: mysql
spec:
  clusterIP: None        # HEADLESS
  selector:
    app: mysql
  ports:
  - port: 3306
    name: mysql


Apply:

kubectl apply -f mysql-headless.yaml

‚úÖ STEP-3: StatefulSet (3-node MySQL cluster skeleton/template)

üëâ mysql-statefulset.yaml

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
spec:
  serviceName: mysql-headless    # IMPORTANT
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        ports:
        - containerPort: 3306
          name: mysql
        env:
        - name: MYSQL_ROOT_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: MYSQL_ROOT_PASSWORD
        volumeMounts:
        - name: mysql-persistent-storage
          mountPath: /var/lib/mysql
  volumeClaimTemplates:
  - metadata:
      name: mysql-persistent-storage
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 2Gi


Apply:

kubectl apply -f mysql-statefulset.yaml

üü¢ STEP-4: Check Pods creation
kubectl get pods -l app=mysql -o wide


Expected:

mysql-0
mysql-1
mysql-2


All should be Running.

üü¢ STEP-5: Check PVCs created per pod
kubectl get pvc


Expected:
 
mysql-persistent-storage-mysql-0
mysql-persistent-storage-mysql-1
mysql-persistent-storage-mysql-2


This proves volumeClaimTemplates is working.

üü¢ STEP-6: Check DNS names (MOST IMPORTANT)

Test DNS resolve from inside cluster:

kubectl exec -it mysql-0 -- nslookup mysql-headless


Output will show pod IPs:

Name: mysql-headless
Address 1: 10.244.1.10 mysql-0
Address 2: 10.244.2.12 mysql-1
Address 3: 10.244.3.15 mysql-2


This confirms:

‚úî Headless service
‚úî DNS returns pod IPs
‚úî StatefulSet stable identity

üü¢ STEP-7: Connect to MySQL to verify data persistence
kubectl exec -it mysql-0 -- bash
mysql -u root -p
# password = mysql123


Create a test DB:

CREATE DATABASE testdb;


Exit, then delete pod:

kubectl delete pod mysql-0


Check again:

kubectl exec -it mysql-0 -- mysql -u root -p
SHOW DATABASES;


testdb will still be there ‚áí PVC working!

üéØ What You Achieved in This Practical

You successfully tested:

Concept	Verified?
Headless Service	‚úî DNS returns pod IPs
StatefulSet identity	‚úî mysql-0, mysql-1, mysql-2
Persistent storage	‚úî PVC per pod
Stable DNS names	‚úî mysql-0.mysql-headless
Pod restart = no data loss	‚úî tested
Banking-style DB architecture	‚úî practically done
üî• Want Production-Level MySQL Cluster (Full Replication) Next?

I can give you:

‚úÖ MySQL Group Replication (3-node cluster)
‚úÖ MySQL InnoDB Cluster
‚úÖ Galera Cluster (banking-grade)
‚úÖ PostgreSQL Patroni HA
‚úÖ Kafka + Zookeeper StatefulSet
‚úÖ Redis cluster with headless service




controlplane:~$ kubectl exec -it mysql-0 -- nslookup mysql-headless
‡§Ü‡§™‡§ï‡§æ error ‡§¨‡§ø‡§≤‡•ç‡§ï‡•Å‡§≤ ‡§∏‡§π‡•Ä ‡§π‡•à ‚Äî MySQL image ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ nslookup install ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ, ‡§á‡§∏‡§≤‡§ø‡§è Kubernetes exec command fail ‡§π‡•ã ‡§ó‡§à‡•§


‡§Æ‡§§‡§≤‡§¨ MySQL container ‡§Æ‡•á‡§Ç nslookup ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§

‡§ï‡•ã‡§à ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§ ‡§®‡§π‡•Ä‡§Ç ‚Äî DNS test ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è 3 ‡§Ü‡§∏‡§æ‡§® ‡§§‡§∞‡•Ä‡§ï‡•á ‡§π‡•à‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§¨‡§∏‡•á ‡§Ü‡§∏‡§æ‡§® ‡§§‡§∞‡•Ä‡§ï‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ú‡•ã KillerKoda ‡§Æ‡•á‡§Ç 100% ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§

‚úÖ ‚úî Method-1 (Recommended): BusyBox Pod ‡§¨‡§®‡§æ‡§ï‡§∞ DNS ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç

MySQL pod ‡§Æ‡•á‡§Ç nslookup ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡§Æ ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ pod ‡§¨‡§®‡§æ‡§è‡§Å‡§ó‡•á:


Kubernetes ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ï‡•ã‡§à ‡§≠‡•Ä Pod ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä Service (Headless ‡§Ø‡§æ normal) ‡§ï‡•ã DNS ‡§∏‡•á resolve ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§
‡§á‡§∏‡§≤‡§ø‡§è testpod ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§≠‡•Ä ‡§Ü‡§™‡§ï‡•ã mysql-headless ‡§ï‡•á ‡§∏‡§≠‡•Ä pods ‡§¶‡§ø‡§ñ‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§π‡§Æ mysql-headless ‡§ï‡§æ nslookup ‡§á‡§∏‡§≤‡§ø‡§è ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç:
‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø headless service ‡§π‡•Ä ‡§µ‡§π service ‡§π‡•à ‡§ú‡•ã StatefulSet ‡§ï‡•á ‡§∏‡§≠‡•Ä pods ‡§ï‡•á individual IPs ‡§î‡§∞ hostnames ‡§µ‡§æ‡§™‡§∏ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à‡•§

kubectl run testpod --image=busybox:1.28 --command -- sleep 3600
‡§Ö‡§¨ testpod ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§ú‡§æ‡§ï‡§∞ DNS check ‡§ï‡§∞‡•á‡§Ç:
kubectl exec -it testpod -- nslookup mysql-headless


Expected output:

Name: mysql-headless
Address 1: 10.244.x.x mysql-0
Address 2: 10.244.x.x mysql-1
Address 3: 10.244.x.x mysql-2


‡§Ø‡§æ‡§®‡•Ä Headless Service ‡§∏‡§π‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡•Ä ‡§π‡•à‡•§

‚úÖ ‚úî Method-2: dig ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó (‡§Ö‡§ó‡§∞ dig ‡§µ‡§æ‡§≤‡•Ä image ‡§ö‡§æ‡§π‡§ø‡§è)
kubectl run dnsutils --image=infoblox/dnstools -- sleep 3600
kubectl exec -it dnsutils -- dig mysql-headless

‚úÖ ‚úî Method-3: MySQL pod ‡§∏‡•á ‡§∏‡•Ä‡§ß‡•á ping ‡§ï‡§∞‡•á‡§Ç

(MySQL image ‡§Æ‡•á‡§Ç ping ‡§≠‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡§æ ‚Äî depends on image but usually no.)

Try:

kubectl exec -it mysql-0 -- ping mysql-1.mysql-headless
If ping not available, then fallback to Method 1 (BusyBox).

üí° Why MySQL image does NOT have nslookup?
MySQL official images are minimal:
No nslookup
No dig
No ping
No curl
No wget

‡§á‡§∏‡§≤‡§ø‡§è ‡§π‡§∞ StatefulSet practical ‡§Æ‡•á‡§Ç ‡§π‡§Æ BusyBox pod use ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç DNS test ‡§ï‡•á ‡§≤‡§ø‡§è‡•§
üöÄ Summary (What you should run now)
STEP-1: Create test pod
kubectl run testpod --image=busybox -- sleep 3600

STEP-2: DNS test
kubectl exec -it testpod -- nslookup mysql-headless

